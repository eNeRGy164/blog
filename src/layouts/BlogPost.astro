---
import BaseHead from "@/components/BaseHead.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import Sidebar from "@/components/Sidebar.astro";
import WPArticleSummary from "@/components/WPArticleSummary.astro";
import { sortedPosts } from "@/js/util.js";
import RelatedPosts from "@/components/RelatedPosts.astro";

interface Frontmatter {
  title: string;
  description: string;
  excerpt: string;
  date: string;
  modified?: string;
  author: string;
  categories: string[];
  tags: string[];
  permalink: string;
}

const posts = sortedPosts(await Astro.glob("../posts/*.md"));
const { frontmatter } = Astro.props;
const { title, description, excerpt, date, modified, author, categories, tags, permalink } = frontmatter as Frontmatter;

const pageDescription = excerpt == undefined ? description : excerpt.replaceAll(/[\r\n]{1,2}/g, " ").trim();
---

<html lang="en-US">
  <head>
    <BaseHead
      title={title}
      description={pageDescription}
      author={author}
      article={{ published: date, modified: modified ?? date, sections: categories, tags: tags }}
    />
  </head>
  <body itemscope itemtype="http://schema.org/ItemPage" id="body">
    <meta itemprop="inLanguage" content="en-US" />
    <link itemprop="url" href={Astro.url} />
    <meta itemprop="name" content={title} />
    <meta itemprop="lastReviewed" content={date} />
    <div class="skip-content"><a href="#content">Skip to content</a></div>
    <div id="wrapper">
      <Header />
      <main
        id="content"
        itemprop="mainEntity"
        itemscope
        itemtype="http://schema.org/BlogPosting"
        itemref="author"
        itemid={permalink}>
        <WPArticleSummary page={Astro.props} />
      </main>
      <RelatedPosts {frontmatter} posts={[...posts]} />
      <Sidebar />
      <Footer posts={[...posts]} />
    </div>
    <noscript><div><img referrerpolicy="no-referrer-when-downgrade" src="https://piwik.hompus.nl/matomo.php?idsite=1&amp;rec=1" style="border:0" alt="" /></div></noscript>
  </body>
</html>
