---
import { urlifyToken } from "@/js/util.js";
import moment from "moment";

import type { CollectionEntry } from 'astro:content';

interface Props {
  categories: string[];
  date: Date;
  updated?: Date;
  previousPost?: CollectionEntry<'posts'> | null;
  nextPost?: CollectionEntry<'posts'> | null;
}

const { categories, date, updated, previousPost, nextPost } = Astro.props;

const sortedCategories = Array.from(new Set(categories as string[])).sort((a, b) => a.localeCompare(b));

const lastUpdated = typeof updated !== "undefined" ? updated : date;
const lastUpdatedMoment = moment(lastUpdated);
---

<footer class="post-footer">
  <div class="category">
    {
      sortedCategories.length > 0 && (
        <>
          Filed under
          {sortedCategories.map((category, idx) => (
            <>
              <a href={`/category/${urlifyToken(category)}/`} rel="category">{category.replace('csharp', 'C#')}</a>{idx < categories.length - 1 ? ", " : null}
            </>
          ))}
        </>
      )
    }
    <div>
      Last update: <time datetime={lastUpdated} itemprop="dateModified">{lastUpdatedMoment.format("MMM D YYYY HH:mm")}</time>
    </div>
  </div>
  {(previousPost || nextPost) && (
    <nav class="post-navigation" aria-label="Post navigation">
      <div class="nav-links">
        {previousPost && (
          <div class="nav-previous">
            <a href={previousPost.data.permalink} rel="prev">
              <span aria-hidden="true">← </span>
              <span class="nav-title">{previousPost.data.title}</span>
            </a>
          </div>
        )}
        {nextPost && (
          <div class="nav-next">
            <a href={nextPost.data.permalink} rel="next">
              <span class="nav-title">{nextPost.data.title}</span>
              <span aria-hidden="true"> →</span>
            </a>
          </div>
        )}
      </div>
    </nav>
  )}
</footer>

<style>
  .post-navigation {
    margin-top: 1.5rem;
    padding-top: 1rem;
    border-top: 1px solid #e0e0e0;
  }

  .nav-links {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .nav-previous {
    text-align: left;
  }

  .nav-next {
    text-align: right;
  }

  .nav-links a {
    color: #0066cc;
    text-decoration: none;
    display: inline-block;
  }

  .nav-links a:hover {
    text-decoration: underline;
  }

  .nav-title {
    font-weight: 500;
  }
</style>
